<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=393, height=852, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QuantTool - ç­–ç•¥è¯¦æƒ…</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* AIèŠå¤©åº•éƒ¨å¼¹çª—æ ·å¼ */
        .ai-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .ai-sheet-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .ai-sheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 60%;
            background: var(--bg-dark);
            border-radius: 24px 24px 0 0;
            z-index: 101;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .ai-sheet.show {
            transform: translateY(0);
        }

        .ai-sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .ai-sheet-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
        }

        .ai-sheet-title .icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .ai-sheet-close {
            width: 32px;
            height: 32px;
            background: var(--bg-input);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            cursor: pointer;
        }

        .ai-sheet-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
        }

        .ai-msg {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .ai-msg.user {
            flex-direction: row-reverse;
        }

        .ai-msg-avatar {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 14px;
        }

        .ai-msg.ai .ai-msg-avatar {
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            color: white;
        }

        .ai-msg.user .ai-msg-avatar {
            background: var(--bg-input);
            color: var(--text-secondary);
        }

        .ai-msg-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
        }

        .ai-msg.ai .ai-msg-bubble {
            background: var(--bg-card);
            border-radius: 4px 16px 16px 16px;
        }

        .ai-msg.user .ai-msg-bubble {
            background: var(--color-primary);
            color: white;
            border-radius: 16px 4px 16px 16px;
        }

        .ai-sheet-input {
            display: flex;
            gap: 10px;
            padding: 12px 20px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-dark);
        }

        .ai-sheet-input input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .ai-sheet-input input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .ai-sheet-input button {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
        }

        .quick-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-suggestion {
            padding: 8px 14px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-suggestion:hover {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }
    </style>
</head>

<body>
    <!-- åŠ¨æ€å²› -->
    <div class="dynamic-island"></div>

    <!-- iOSçŠ¶æ€æ  -->
    <div class="status-bar">
        <span class="status-bar-time">23:07</span>
        <div class="status-bar-icons">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-full battery"></i>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <!-- å¯¼èˆªæ  -->
        <div class="page-header" style="padding-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <a href="strategies.html" style="color: var(--text-primary); font-size: 20px;">
                    <i class="fas fa-chevron-left"></i>
                </a>
                <span style="font-size: 17px; font-weight: 600;">ç­–ç•¥è¯¦æƒ…</span>
            </div>
            <button class="btn btn-secondary btn-sm" style="padding: 8px; border-radius: 8px;">
                <i class="fas fa-ellipsis-h"></i>
            </button>
        </div>

        <div class="page-container" style="padding-top: 0;">
            <!-- ç­–ç•¥ä¿¡æ¯å¡ç‰‡ -->
            <div class="card"
                style="background: linear-gradient(135deg, var(--color-primary) 0%, #8B5CF6 100%); border: none;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div
                        style="width: 52px; height: 52px; background: rgba(255,255,255,0.2); border-radius: 14px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-bolt" style="font-size: 24px; color: white;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-size: 20px; font-weight: 700; color: white;">ç½‘æ ¼äº¤æ˜“ç­–ç•¥</div>
                        <div style="font-size: 13px; color: rgba(255,255,255,0.7);">BTC/USDT Â· ç°è´§äº¤æ˜“</div>
                    </div>
                    <!-- è‡ªå»ºç­–ç•¥æ ‡ç­¾ -->
                    <span
                        style="padding: 4px 10px; background: rgba(255,255,255,0.2); border-radius: 8px; font-size: 11px; color: white;">
                        <i class="fas fa-user" style="font-size: 9px;"></i> è‡ªå»º
                    </span>
                </div>
                <div style="display: flex; gap: 24px;">
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: white;">+28.56%</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7);">ç´¯è®¡æ”¶ç›Šç‡</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: white;">$3,421</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7);">æ”¶ç›Šé‡‘é¢</div>
                    </div>
                </div>
            </div>

            <!-- ä¸€é”®æ“ä½œæŒ‰é’® (è‡ªå»ºç­–ç•¥æ˜¾ç¤ºAIä¿®æ”¹æŒ‰é’®) -->
            <div class="grid-3 mb-4" style="grid-template-columns: 1fr 1fr 1fr;">
                <button class="btn btn-primary btn-block" style="padding: 14px;" id="backtest-btn"
                    onclick="goToBacktest()">
                    <i class="fas fa-history"></i>
                    å›æµ‹
                </button>
                <button class="btn btn-success btn-block" style="padding: 14px;" id="apply-btn">
                    <i class="fas fa-rocket"></i>
                    åº”ç”¨
                </button>
                <button class="btn btn-secondary btn-block"
                    style="padding: 14px; background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%); border: none;"
                    id="ai-modify-btn" onclick="openAISheet()">
                    <i class="fas fa-magic"></i>
                    AIä¿®æ”¹
                </button>
            </div>

            <!-- ç­–ç•¥å‚æ•° -->
            <div class="flex-between mb-3">
                <span class="font-bold">ç­–ç•¥å‚æ•°</span>
                <a href="#" style="color: var(--color-primary); font-size: 13px; text-decoration: none;">ç¼–è¾‘ <i
                        class="fas fa-pen" style="font-size: 10px;"></i></a>
            </div>

            <div class="card">
                <div class="list-item">
                    <div class="list-content">
                        <div class="list-title">äº¤æ˜“å¯¹</div>
                    </div>
                    <div style="font-weight: 500;">BTC/USDT</div>
                </div>
                <div class="list-item">
                    <div class="list-content">
                        <div class="list-title">ç½‘æ ¼æ•°é‡</div>
                    </div>
                    <div style="font-weight: 500;">20 æ ¼</div>
                </div>
                <div class="list-item">
                    <div class="list-content">
                        <div class="list-title">ä»·æ ¼åŒºé—´</div>
                    </div>
                    <div style="font-weight: 500;">$35,000 - $50,000</div>
                </div>
                <div class="list-item">
                    <div class="list-content">
                        <div class="list-title">å•æ ¼æŠ•å…¥</div>
                    </div>
                    <div style="font-weight: 500;">$500 USDT</div>
                </div>
                <div class="list-item">
                    <div class="list-content">
                        <div class="list-title">æ­¢æŸä»·æ ¼</div>
                    </div>
                    <div style="font-weight: 500;">$32,000</div>
                </div>
                <div class="list-item" style="border-bottom: none;">
                    <div class="list-content">
                        <div class="list-title">æ­¢ç›ˆä»·æ ¼</div>
                    </div>
                    <div style="font-weight: 500;">$55,000</div>
                </div>
            </div>

            <!-- è¿è¡Œç»Ÿè®¡ -->
            <div class="flex-between mb-3 mt-4">
                <span class="font-bold">è¿è¡Œç»Ÿè®¡</span>
            </div>

            <div class="grid-2 mb-3">
                <div class="card" style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--color-success);">72%</div>
                    <div class="text-xs text-muted mt-2">èƒœç‡</div>
                </div>
                <div class="card" style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700;">156</div>
                    <div class="text-xs text-muted mt-2">æˆäº¤æ¬¡æ•°</div>
                </div>
            </div>
            <div class="grid-2">
                <div class="card" style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700;">32å¤©</div>
                    <div class="text-xs text-muted mt-2">è¿è¡Œæ—¶é—´</div>
                </div>
                <div class="card" style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--color-primary);">1.89</div>
                    <div class="text-xs text-muted mt-2">å¤æ™®æ¯”ç‡</div>
                </div>
            </div>

            <!-- å›æµ‹æŠ¥å‘Šå…¥å£ -->
            <div id="backtestHistorySection" style="display: none;">
                <div class="flex-between mb-3 mt-4">
                    <span class="font-bold">å›æµ‹è®°å½•</span>
                    <a href="#" onclick="goToBacktest(); return false;"
                        style="color: var(--color-primary); font-size: 13px; text-decoration: none;">æ–°å›æµ‹ <i
                            class="fas fa-plus" style="font-size: 10px;"></i></a>
                </div>
                <div class="card" id="backtestHistoryCard" style="cursor: pointer;" onclick="viewBacktestReport()">
                    <div class="list-item" style="border-bottom: none;">
                        <div class="list-icon"
                            style="background: rgba(99, 102, 241, 0.15); color: var(--color-primary);">
                            <i class="fas fa-chart-area"></i>
                        </div>
                        <div class="list-content">
                            <div class="list-title" id="lastBacktestTitle">æœ€è¿‘å›æµ‹</div>
                            <div class="list-subtitle" id="lastBacktestInfo">-</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="backtestCount" class="card-badge badge-primary">0</span>
                            <i class="fas fa-chevron-right list-action"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ”¶ç›Šæ›²çº¿ -->
            <div class="flex-between mb-3 mt-4">
                <span class="font-bold">æ”¶ç›Šæ›²çº¿</span>
                <a href="performance.html"
                    style="color: var(--color-primary); font-size: 13px; text-decoration: none;">è¯¦æƒ… <i
                        class="fas fa-chevron-right" style="font-size: 10px;"></i></a>
            </div>

            <div class="chart-container">
                <canvas id="profitChart" height="180"></canvas>
            </div>

            <!-- åº•éƒ¨å ä½ -->
            <div style="height: 20px;"></div>
        </div>
    </div>

    <!-- AIä¿®æ”¹åº•éƒ¨å¼¹çª— -->
    <div class="ai-sheet-overlay" id="aiSheetOverlay" onclick="closeAISheet()"></div>
    <div class="ai-sheet" id="aiSheet">
        <div class="ai-sheet-header">
            <div class="ai-sheet-title">
                <div class="icon"><i class="fas fa-magic"></i></div>
                <span>AI ç­–ç•¥ä¿®æ”¹</span>
            </div>
            <button class="ai-sheet-close" onclick="closeAISheet()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ai-sheet-messages" id="aiMessages">
            <!-- AIæ¬¢è¿æ¶ˆæ¯ -->
            <div class="ai-msg ai">
                <div class="ai-msg-avatar"><i class="fas fa-robot"></i></div>
                <div class="ai-msg-bubble">
                    <div style="font-weight: 600; margin-bottom: 8px;">ğŸ¯ ç­–ç•¥ä¼˜åŒ–åŠ©æ‰‹</div>
                    <div>æˆ‘å¯ä»¥å¸®ä½ ä¼˜åŒ–ã€Œç½‘æ ¼äº¤æ˜“ç­–ç•¥ã€çš„å‚æ•°ï¼š</div>
                    <ul style="margin: 8px 0; padding-left: 18px; color: var(--text-secondary);">
                        <li>è°ƒæ•´ç½‘æ ¼æ•°é‡å’Œé—´è·</li>
                        <li>ä¼˜åŒ–ä»·æ ¼åŒºé—´è®¾ç½®</li>
                        <li>ä¿®æ”¹æ­¢æŸæ­¢ç›ˆå‚æ•°</li>
                        <li>æ ¹æ®å¸‚åœºæƒ…å†µæ™ºèƒ½è°ƒå‚</li>
                    </ul>
                    <div class="quick-suggestions">
                        <span class="quick-suggestion" onclick="sendQuickMsg('é™ä½é£é™©')">ğŸ›¡ï¸ é™ä½é£é™©</span>
                        <span class="quick-suggestion" onclick="sendQuickMsg('æé«˜æ”¶ç›Š')">ğŸ“ˆ æé«˜æ”¶ç›Š</span>
                        <span class="quick-suggestion" onclick="sendQuickMsg('é€‚åº”éœ‡è¡')">ğŸ”„ é€‚åº”éœ‡è¡</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="ai-sheet-input">
            <input type="text" id="aiInput" placeholder="æè¿°ä½ æƒ³è¦çš„ä¿®æ”¹..." onkeypress="if(event.key==='Enter')sendAIMsg()">
            <button onclick="sendAIMsg()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- åº•éƒ¨Tab Bar -->
    <div class="tab-bar">
        <a href="home.html" class="tab-item">
            <i class="fas fa-home"></i>
            <span>é¦–é¡µ</span>
        </a>
        <a href="strategies.html" class="tab-item active">
            <i class="fas fa-cube"></i>
            <span>ç­–ç•¥</span>
        </a>
        <a href="marketplace.html" class="tab-item">
            <i class="fas fa-store"></i>
            <span>å¸‚åœº</span>
        </a>
        <a href="ai-strategy.html" class="tab-item">
            <i class="fas fa-robot"></i>
            <span>AI</span>
        </a>
        <a href="accounts.html" class="tab-item">
            <i class="fas fa-wallet"></i>
            <span>è´¦æˆ·</span>
        </a>
    </div>

    <script>
        // æ”¶ç›Šæ›²çº¿å›¾è¡¨
        const ctx = document.getElementById('profitChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 180);
        gradient.addColorStop(0, 'rgba(99, 102, 241, 0.3)');
        gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                datasets: [{
                    label: 'æ”¶ç›Šç‡',
                    data: [0, 3.2, 5.8, 8.1, 12.4, 15.6, 14.2, 18.9, 22.3, 25.1, 24.8, 28.56],
                    borderColor: '#6366F1',
                    backgroundColor: gradient,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: '#6366F1',
                    pointHoverBorderColor: 'white',
                    pointHoverBorderWidth: 2,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#64748B', font: { size: 10 } } },
                    y: {
                        grid: { color: 'rgba(51, 65, 85, 0.5)' },
                        ticks: { color: '#64748B', font: { size: 10 }, callback: v => v + '%' }
                    }
                },
                interaction: { intersect: false, mode: 'index' }
            }
        });

        // AI Sheet æ§åˆ¶
        function openAISheet() {
            document.getElementById('aiSheetOverlay').classList.add('show');
            document.getElementById('aiSheet').classList.add('show');
        }

        function closeAISheet() {
            document.getElementById('aiSheetOverlay').classList.remove('show');
            document.getElementById('aiSheet').classList.remove('show');
        }

        function addMessage(text, isUser) {
            const container = document.getElementById('aiMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `ai-msg ${isUser ? 'user' : 'ai'}`;
            msgDiv.innerHTML = `
        <div class="ai-msg-avatar"><i class="fas fa-${isUser ? 'user' : 'robot'}"></i></div>
        <div class="ai-msg-bubble">${text}</div>
      `;
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
        }

        function sendAIMsg() {
            const input = document.getElementById('aiInput');
            const text = input.value.trim();
            if (!text) return;

            addMessage(text, true);
            input.value = '';

            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                let response = '';
                if (text.includes('é£é™©') || text.includes('é™ä½')) {
                    response = `<div style="font-weight: 600; margin-bottom: 8px;">âœ… å·²ä¸ºæ‚¨è°ƒæ•´ä¸ºä½é£é™©æ¨¡å¼</div>
            <div style="background: var(--bg-input); padding: 12px; border-radius: 10px; font-size: 13px; margin-top: 8px;">
              <div style="display: flex; justify-content: space-between; padding: 4px 0;"><span style="color: var(--text-muted);">ç½‘æ ¼æ•°é‡</span><span>20æ ¼ â†’ <span style="color: #22C55E;">30æ ¼</span></span></div>
              <div style="display: flex; justify-content: space-between; padding: 4px 0;"><span style="color: var(--text-muted);">ä»·æ ¼åŒºé—´</span><span>$35K-$50K â†’ <span style="color: #22C55E;">$38K-$46K</span></span></div>
              <div style="display: flex; justify-content: space-between; padding: 4px 0;"><span style="color: var(--text-muted);">é¢„ä¼°å›æ’¤</span><span>-12% â†’ <span style="color: #22C55E;">-6%</span></span></div>
            </div>
            <div style="margin-top: 10px;"><button class="btn btn-primary btn-sm" onclick="applyChanges()">åº”ç”¨ä¿®æ”¹</button></div>`;
                } else if (text.includes('æ”¶ç›Š') || text.includes('æé«˜')) {
                    response = `<div style="font-weight: 600; margin-bottom: 8px;">ğŸ“ˆ æ¿€è¿›æ”¶ç›Šæ¨¡å¼å»ºè®®</div>
            <div style="background: var(--bg-input); padding: 12px; border-radius: 10px; font-size: 13px; margin-top: 8px;">
              <div style="display: flex; justify-content: space-between; padding: 4px 0;"><span style="color: var(--text-muted);">ç½‘æ ¼æ•°é‡</span><span>20æ ¼ â†’ <span style="color: #F59E0B;">15æ ¼</span></span></div>
              <div style="display: flex; justify-content: space-between; padding: 4px 0;"><span style="color: var(--text-muted);">ä»·æ ¼åŒºé—´</span><span>$35K-$50K â†’ <span style="color: #F59E0B;">$32K-$55K</span></span></div>
              <div style="display: flex; justify-content: space-between; padding: 4px 0;"><span style="color: var(--text-muted);">é¢„ä¼°æ”¶ç›Š</span><span>+28% â†’ <span style="color: #F59E0B;">+45%</span></span></div>
            </div>
            <div style="color: #EF4444; font-size: 12px; margin-top: 8px;"><i class="fas fa-exclamation-triangle"></i> é£é™©è¾ƒé«˜ï¼Œè¯·è°¨æ…ä½¿ç”¨</div>
            <div style="margin-top: 10px;"><button class="btn btn-primary btn-sm" onclick="applyChanges()">åº”ç”¨ä¿®æ”¹</button></div>`;
                } else {
                    response = `<div>å¥½çš„ï¼Œæˆ‘æ¥åˆ†æä¸€ä¸‹æ‚¨çš„éœ€æ±‚...</div>
            <div style="margin-top: 8px; color: var(--text-secondary);">æ ¹æ®å½“å‰å¸‚åœºæƒ…å†µå’Œæ‚¨çš„ç­–ç•¥è¡¨ç°ï¼Œå»ºè®®ï¼š</div>
            <ul style="margin: 8px 0; padding-left: 18px; color: var(--text-secondary);">
              <li>ä¿æŒå½“å‰ç½‘æ ¼å¯†åº¦</li>
              <li>ç•¥å¾®æ”¶ç´§ä»·æ ¼åŒºé—´ä»¥é™ä½é£é™©</li>
              <li>è®¾ç½®æ›´ä¸¥æ ¼çš„æ­¢æŸçº¿</li>
            </ul>
            <div style="margin-top: 10px;">éœ€è¦æˆ‘å¸®æ‚¨è‡ªåŠ¨ä¼˜åŒ–å—ï¼Ÿ</div>`;
                }
                addMessage(response, false);
            }, 800);
        }

        function sendQuickMsg(text) {
            document.getElementById('aiInput').value = text;
            sendAIMsg();
        }

        function applyChanges() {
            closeAISheet();
            // æ¨¡æ‹ŸToast
            const toast = document.createElement('div');
            toast.style.cssText = `
        position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
        background: rgba(34, 197, 94, 0.95); color: white; padding: 12px 20px;
        border-radius: 12px; font-size: 14px; font-weight: 500; z-index: 1000;
        display: flex; align-items: center; gap: 8px;
      `;
            toast.innerHTML = '<i class="fas fa-check-circle"></i> ç­–ç•¥å‚æ•°å·²æ›´æ–°';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        function goToBacktest() {
            const strategyId = localStorage.getItem('current_my_strategy');
            if (strategyId) {
                localStorage.setItem('current_strategy_id', strategyId);
                window.location.href = 'backtest-setup.html';
            }
        }

        function viewBacktestReport() {
            const strategyId = localStorage.getItem('current_my_strategy');
            if (strategyId) {
                const backtests = store.getBacktestsByStrategy(strategyId);
                if (backtests.length > 0) {
                    localStorage.setItem('current_backtest_id', backtests[0].id);
                    window.location.href = 'backtest-report.html';
                }
            }
        }

        // åˆå§‹åŒ–å›æµ‹å†å²åŒºåŸŸ
        document.addEventListener('DOMContentLoaded', function () {
            const strategyId = localStorage.getItem('current_my_strategy');
            if (strategyId && typeof store !== 'undefined') {
                const backtests = store.getBacktestsByStrategy(strategyId);
                if (backtests.length > 0) {
                    document.getElementById('backtestHistorySection').style.display = 'block';
                    document.getElementById('backtestCount').textContent = backtests.length + ' æ¡';

                    const lastBt = backtests[0];
                    const date = new Date(lastBt.created_at);
                    const dateStr = date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                    const returnStr = lastBt.metrics.return_total >= 0
                        ? '+' + lastBt.metrics.return_total + '%'
                        : lastBt.metrics.return_total + '%';

                    document.getElementById('lastBacktestTitle').textContent =
                        `${lastBt.config.period} Â· ${lastBt.config.timeframe} Â· æ”¶ç›Š ${returnStr}`;
                    document.getElementById('lastBacktestInfo').textContent =
                        `${dateStr} Â· åˆå§‹èµ„é‡‘ $${lastBt.config.initial_capital.toLocaleString()}`;
                }
            }
        });
    </script>
</body>

</html>